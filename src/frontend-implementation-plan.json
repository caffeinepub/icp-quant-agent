{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Version 10 Frontend: Tick Sync, System Ready Indicator, and Persistent Timer Failure Notifications",
  "requirements": [
    {
      "id": "REQ-6",
      "summary": "Add a polled System Ready guard status and display it on the Market Watch dashboard with an English tooltip explaining missing conditions.",
      "acceptanceCriteria": [
        "Dashboard shows a green shield icon only when all three conditions are true.",
        "Dashboard provides an English tooltip or label that explains which condition(s) are missing when not ready."
      ],
      "file_operations": [
        {
          "path": "frontend/src/backend.d.ts",
          "operation": "modify",
          "description": "Update generated type definitions to include the new backend status shape for Version 10 (isMainnet, liveSourceEnabled, timerRunning, systemReady)."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query hook to poll the backend status capability (single response containing isMainnet, liveSourceEnabled, timerRunning, systemReady) and expose it for UI consumption."
        },
        {
          "path": "frontend/src/components/SystemReadyIndicator.tsx",
          "operation": "create",
          "description": "Create a dashboard-ready indicator component that renders a green shield when systemReady is true and a clear not-ready state when false, including an English tooltip listing which condition(s) are missing. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/MarketWatchPage.tsx",
          "operation": "modify",
          "description": "Wire the SystemReadyIndicator into the Market Watch header area so it is visible on the Dashboard and uses the polled status hook to drive icon state and tooltip messaging. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-7",
      "summary": "Surface timer start failures as a persistent \"Canister Timeout\" warning in a Notification Center UI (not just a toast).",
      "acceptanceCriteria": [
        "Frontend renders a Notification Center area that lists active warnings.",
        "When timer start fails, a persistent warning labeled exactly \"Canister Timeout\" appears in the Notification Center until cleared or the condition is resolved."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/notificationCenter.ts",
          "operation": "create",
          "description": "Add a small notification-center state module (in-memory) for persistent warnings, including add/remove/clear helpers and a stable key for the \"Canister Timeout\" warning."
        },
        {
          "path": "frontend/src/hooks/useNotificationCenter.ts",
          "operation": "create",
          "description": "Create a React hook wrapper around the notification-center state to allow UI components and mutation error handlers to add/remove persistent warnings."
        },
        {
          "path": "frontend/src/components/NotificationCenter.tsx",
          "operation": "create",
          "description": "Implement a Notification Center UI region that lists active warnings (including \"Canister Timeout\") and supports clearing/dismissing warnings where appropriate. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Wire NotificationCenter into the global app shell so warnings are persistently visible across pages (not only via transient toasts). Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/backend.d.ts",
          "operation": "modify",
          "description": "Update frontend bindings to reflect Version 10 backend call results that can report timer-start failure (e.g., start flow result type), so the UI can reliably detect and label \"Canister Timeout\"."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update agent/timer start mutations to handle failure results (or thrown errors) by adding a persistent Notification Center warning labeled exactly \"Canister Timeout\", and removing it when a subsequent successful start/status indicates the condition is resolved."
        }
      ]
    },
    {
      "id": "REQ-8",
      "summary": "Align tick-dependent UI refresh cadence to the backend 10-second timer by polling last_update_id every 10 seconds and refreshing widgets only when it changes.",
      "acceptanceCriteria": [
        "Frontend polls last_update_id every 10 seconds.",
        "Tick-dependent UI refreshes are keyed off changes to last_update_id (no extra intermediate refreshes that imply ticks that did not occur).",
        "The 1-minute volatility chart updates once per backend tick when live sampling is active."
      ],
      "file_operations": [
        {
          "path": "frontend/src/backend.d.ts",
          "operation": "modify",
          "description": "Update type definitions to include the Version 10 backend query for last_update_id so the frontend can poll it."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a React Query hook that polls last_update_id on a 10-second interval and exposes it as the single source of truth for tick synchronization."
        },
        {
          "path": "frontend/src/components/CkBtcIcpRatioWidget.tsx",
          "operation": "modify",
          "description": "Rework sampling and refresh behavior for the 1-minute volatility chart to be keyed off changes to polled last_update_id (one sample per backend tick), avoiding intermediate refreshes that could imply non-existent ticks."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Adjust tick-dependent queries used by the Market Watch dashboard widgets (including ckBTC/ICP ratio data) to refetch based on last_update_id changes rather than high-frequency intervals."
        }
      ]
    },
    {
      "id": "REQ-9",
      "summary": "Finalize Version 10 frontend compatibility by updating bindings and hooks to match backend signature changes and ensuring a clean TypeScript build.",
      "acceptanceCriteria": [
        "Frontend compiles with no TypeScript errors after backend API changes.",
        "All new Version 10 behaviors (System Ready guard, Canister Timeout notification, 10s tick sync) are verifiable via the UI."
      ],
      "file_operations": [
        {
          "path": "frontend/src/backend.d.ts",
          "operation": "modify",
          "description": "Sync frontend TypeScript bindings with the Version 10 backend candid/signature changes (status response, last_update_id query, and start flow result reporting), ensuring the backendInterface type is accurate."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update or add React Query hooks to use the Version 10 backend capabilities (status polling, last_update_id polling, start flow result handling) and ensure consistent cache invalidation/refetch behavior."
        },
        {
          "path": "frontend/src/pages/MarketWatchPage.tsx",
          "operation": "modify",
          "description": "Ensure Market Watch composes Version 10 UI elements (System Ready indicator and tick-synced widgets) without TypeScript errors and with English user-facing labels."
        },
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Ensure the global Notification Center wiring compiles cleanly and remains compatible with existing layout/navigation without editing any immutable UI component paths."
        }
      ]
    }
  ]
}