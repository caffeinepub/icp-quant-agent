{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "icp_quant_agent (\"Hyper-Canister Quantum\") is a Motoko canister + React dashboard prototype for an on-chain quant/arbitrage agent workflow (Sensory Cortex → Executive Engine (dry-run) → Evolutionary Lab). The backend canister stores DEX configurations and market telemetry (snapshots, latency metrics, decision events), maintains a ring buffer of recent price points, performs HTTPS outcalls (currently used for Binance), and implements basic signal detection with risk classification plus an initial shadow-execution/backtesting data model. The frontend provides a multi-page dashboard (Market Watch, Configuration, Agent, Execution, Self-Improvement) with Internet Identity auth, React Query hooks to call the canister, monitoring panels (spread/volatility, ratio widget), and self-improvement views (live detections, optimizer dataset stats, shadow-execution metrics/log UI).",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Motoko backend canister core with migration hook",
      "synonyms": [
        "backend actor",
        "canister core",
        "upgrade migration wiring"
      ],
      "description": "Implements the main Motoko actor (`backend/main.mo`) and wires a migration hook (`with migration = Migration.run`) to support upgrade-time state handling.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "HTTPS outcalls helper module with transform",
      "synonyms": [
        "IC management canister http_request",
        "httpGetRequest/httpPostRequest"
      ],
      "description": "Provides reusable HTTP GET/POST helpers and a response transform (`backend/http-outcalls/outcall.mo`) to call external HTTPS APIs with cycle budgeting.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "DEX configuration registry (DEX list + trading pairs)",
      "synonyms": [
        "DEX configs",
        "trading pair configuration"
      ],
      "description": "Stores DEX configs in a Map keyed by numeric ID, supports adding DEX configs, updating per-DEX trading pairs, and querying all/sorted configs.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Persisted DEX identifier configuration",
      "synonyms": [
        "ICPSwap/KongSwap canister IDs",
        "getDexConfig/setDexConfig"
      ],
      "description": "Backend exposes `getDexConfig`/`setDexConfig` for storing optional ICPSwap and KongSwap canister identifiers; frontend provides a configuration form with default behavior (blank = use default ICPSwap ID).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "Price snapshot recording",
      "synonyms": [
        "PriceSnapshot log",
        "recordPriceSnapshot"
      ],
      "description": "Backend appends `PriceSnapshot` entries to a snapshot log; frontend can record Binance snapshots during Market Watch refresh.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "Arbitrage spread analysis and decision logging (dry-run)",
      "synonyms": [
        "runArbitrageAnalysis",
        "runArbitrageAnalysisBetweenDEXs"
      ],
      "description": "Backend computes a simple spread-based arbitrage signal between two DEX price snapshots and appends an analysis `DecisionEvent` to the decision log.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Decision history log and agent lifecycle events",
      "synonyms": [
        "decision log",
        "startAgent/stopAgent"
      ],
      "description": "Backend records decision events and exposes `getDecisionHistory`; includes `startAgent`/`stopAgent` endpoints that append lifecycle events used by the frontend Agent page.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "Latency metrics telemetry and smart delay heuristic",
      "synonyms": [
        "latency metrics",
        "calculateSmartDelay"
      ],
      "description": "Backend records `LatencyMetric` entries (including outcall timing) and exposes `getAllLatencyMetrics` plus a `calculateSmartDelay` heuristic derived from recent telemetry.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Ring-buffered pool price point storage",
      "synonyms": [
        "PricePoint buffer",
        "getPoolPrice/getAllPoolPrices"
      ],
      "description": "Backend maintains a custom ring buffer for recent `PricePoint`s, supports appending points and reading the latest or full buffered series.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Binance price fetch endpoint with latency logging",
      "synonyms": [
        "fetchUSDTPriceFromBinance",
        "external API measurement"
      ],
      "description": "Backend exposes `fetchUSDTPriceFromBinance` that performs an HTTPS outcall and records a latency metric (price return value is currently mocked).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "On-canister live signal detection with risk classification",
      "synonyms": [
        "SignalDetectionEvent",
        "detectLiveSignal"
      ],
      "description": "Backend computes price deviation vs a moving average, triggers signals above a threshold, classifies risk using TVL and signal frequency, and persists derived metrics (estimated return, safe order size, highRisk flag).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "Safe optimizer dataset query (filters out high-risk events)",
      "synonyms": [
        "getSafeOptimizerDataset",
        "optimizer training dataset"
      ],
      "description": "Backend exposes `getSafeOptimizerDataset` which filters `SignalDetectionEvent`s to exclude those marked high risk; frontend displays dataset counts and recency in the Optimizer panel.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Shadow execution (paper trading) data model and metrics endpoint",
      "synonyms": [
        "ShadowTrade",
        "getShadowExecutionMetrics"
      ],
      "description": "Backend creates shadow trades for safe signals, stores trade state, and exposes aggregated metrics (total opportunities, success rate, avg spread captured) plus a trade log view via `getShadowExecutionMetrics`.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Shadow trade evaluation timer hook (stubbed)",
      "synonyms": [
        "startShadowTradeEvaluationTimer",
        "recurringTimer evaluation"
      ],
      "description": "Backend includes a 10-second recurring timer entry point intended to evaluate shadow trades; current evaluation behavior is placeholder/sample logic.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "React dashboard scaffold with routing and global layout",
      "synonyms": [
        "TanStack Router",
        "AppLayout + SideNav"
      ],
      "description": "Frontend provides a multi-page dashboard (Market Watch, Configuration, Agent, Execution, Self-Improvement) with a persistent layout shell (header, sidebar nav, footer).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Themed UI system (Tailwind + shadcn/ui) with dark mode",
      "synonyms": [
        "design tokens",
        "next-themes"
      ],
      "description": "Implements a consistent UI kit using shadcn/ui components, Tailwind, and CSS-variable tokens with class-based dark mode support.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "Internet Identity authentication and identity-aware canister actor",
      "synonyms": [
        "II login",
        "authenticated actor creation"
      ],
      "description": "Provides an Internet Identity provider with login/logout and persisted sessions; `useActor` recreates the backend actor when identity changes and invalidates/refetches dependent queries.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "React Query hook layer for backend calls with cache invalidation",
      "synonyms": [
        "useQueries",
        "query/mutation wrappers"
      ],
      "description": "Implements query/mutation hooks for DEX config management, snapshots, price buffer operations, decision history, latency metrics, optimizer dataset access, and shadow execution metrics/log retrieval.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "Market Watch dashboard with refresh controls and snapshot drill-down UI",
      "synonyms": [
        "MarketSnapshotGrid",
        "SnapshotDetailsDialog",
        "auto-refresh"
      ],
      "description": "Market Watch page supports manual refresh and interval-based auto-refresh, records a Binance snapshot to the backend, and renders per-pair snapshot cards with a dialog to inspect/copy raw responses.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "ckBTC/ICP ratio monitor widget with 60s sparkline",
      "synonyms": [
        "CkBtcIcpRatioWidget",
        "sparkline chart"
      ],
      "description": "Displays current ratio, a 24h-average comparison, a deviation-based viability signal, and a 1-minute sparkline of samples collected in the browser.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Agent Control page with pipeline visualization, latency signals, and decision history",
      "synonyms": [
        "Agent page",
        "PipelineStatusPanel",
        "DecisionHistoryTable"
      ],
      "description": "Provides start/stop controls, visual HCQ pipeline step status, latency spike detection metrics, and a filterable decision history table with a details dialog.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Sensory Cortex monitor (simulated polling) with spread/volatility and price-point persistence",
      "synonyms": [
        "DEX polling simulation",
        "delta-spread monitor"
      ],
      "description": "When the agent is running, polls simulated ICPSwap/KongSwap prices every 2 seconds, computes spread and volatility, flags arbitrage viability, and persists averaged prices to the backend ring buffer for display.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Execution mode gating and blocked execution requirements UI",
      "synonyms": [
        "execution acknowledgement",
        "execution placeholder"
      ],
      "description": "Execution page requires explicit user acknowledgement before enabling execution mode UI, and then displays a blocked panel listing required DEX integration details.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "Evolutionary Lab (Self-Improvement) dashboard panels",
      "synonyms": [
        "LiveDetectionsPanel",
        "BacktestPanel",
        "OptimizerPanel",
        "StrategyParametersPanel"
      ],
      "description": "Self-Improvement page displays recent detection events (table UI), shadow execution metrics/log UI (auto-refresh), an optimizer dataset summary panel, and a strategy parameter versioning placeholder panel.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "Persistent Notification Center for system warnings",
      "synonyms": [
        "notification center",
        "persistent warnings"
      ],
      "description": "Implements a global warning store with subscribe/update semantics and a UI card that supports dismiss and clear-all; integrated in the start-agent flow to surface persistent timeout warnings on failures.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "System readiness indicator and versioned status polling (frontend support)",
      "synonyms": [
        "SystemReadyIndicator",
        "tri-state readiness UI"
      ],
      "description": "Frontend includes a readiness badge with tooltip that expects a backend `SystemStatus` (isMainnet/liveSourceEnabled/timerRunning/systemReady) and displays missing conditions; hook includes a fallback when the backend API is absent.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Live Sensory Cortex via HTTPS outcall to ICPSwap public API (price0+tvlUSD) on 10s toggle-controlled timer with mainnet guard",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-2",
      "summary": "Signal tracking enrichment + risk tagging: moving-average baseline (last 10), Estimated_Return (delta%-0.6% fees), Max_Safe_Order_Size (tvlUSD*0.2%), per-pair 5 signals/hour + tvlUSD<50k High-Risk; exclude High-Risk from optimizer dataset; show last 20 live detections in Lab",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-3",
      "summary": "Real-time Shadow Execution: create shadow trades for Safe signals, evaluate every 10s for 5 minutes with success/stop-loss/timeout, and bind results to Expected Metrics + backtesting log UI",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-4",
      "summary": "Version-10 pipeline activation & dashboard sync: Start Agent master sequence (env-aware), last_update_id tick synchronization, sub-threshold observations (<1.5%) logging/gray UI/exclusion, tri-state System Ready guard, notification on timer start failure",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-5",
      "summary": "Triangular arbitrage Shadow Engine (Version 11.1): ICPSwap pools xmiu5 (ICP/ckBTC) → 73nps (ckBTC/BOB) → sys7q (BOB/ICP), 100 ICP notional, constant-product math with 0.3% fee/leg, 0.5% slippage failure + short-circuit recovery via xmiu5/ybilh chosen by 1-min MA TVL; log net shadow P/L only",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-6",
      "summary": "Confirm the Version 11.1 triangular shadow simulation uses a fixed notional input amount of exactly 100 ICP as the starting asset for every run of the ICP → ckBTC → BOB → ICP path.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Implement Version 11.1 core triangular shadow arbitrage simulation in the single Motoko actor, using the strict ICPSwap pool route and pool IDs: xmiu5 (ICP/ckBTC) → 73nps (ckBTC/BOB) → sys7q (BOB/ICP). Use constant-product swap math (x*y=k) and apply a 0.3% fee per leg when computing expected outputs.",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Define and enforce Version 11.1 leg failure conditions in shadow mode: treat a leg as failed if either (a) pool data fetch fails for that leg, or (b) computed slippage for that leg exceeds 0.5%. When a failure happens at any leg, stop the forward path immediately and trigger Short-circuit Recovery.",
      "reqIds": [
        "REQ-9"
      ],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Implement the Version 11.1 Short-circuit Recovery simulator: when a forward leg fails, simulate swapping remaining virtual assets back to ICP using the most liquid direct pool chosen by 1-minute moving average TVL. Use xmiu5 as the ckBTC/ICP fallback pool and ybilh as the BOB/ICP fallback pool. Liquidity selection must be based on the 1-minute moving average TVL computed from existing ring-buffer snapshots (do not introduce a new TVL buffer if ring-buffer data already exists).",
      "reqIds": [
        "REQ-10"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Minimal Evolutionary Lab logging for Version 11.1: persist only the final net virtual profit/loss (net shadow return) from each triangular shadow run to the existing Evolutionary Lab logging surface in the backend. Do not add per-leg status UI or the Path Visualizer in this version.",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    }
  ],
  "architectural_notes": [
    "Backend is a single Motoko actor (`backend/main.mo`) with a migration hook (`with migration = Migration.run`) and in-memory state using `Map`/`List` from `mo:core`.",
    "Backend encapsulates management-canister HTTPS outcalls in `backend/http-outcalls/outcall.mo` using a response transform that strips headers.",
    "Backend uses a custom ring buffer implementation for recent `PricePoint` values (enqueue + linearization to array).",
    "Signal detection is computed on-canister from buffered prices using a moving-average deviation threshold and a risk heuristic (TVL + signals/hour).",
    "Shadow execution is modeled as persisted shadow trades with a metrics aggregation query; evaluation is timer-driven but currently stubbed.",
    "Frontend is a React (Vite-style) SPA using TanStack Router for routing and TanStack React Query for server-state caching and invalidation.",
    "Authentication uses Internet Identity via `@dfinity/auth-client`, with identity-aware actor creation and query invalidation on identity changes.",
    "UI is built with Tailwind CSS + shadcn/ui primitives and `next-themes` for class-based dark mode and design tokens.",
    "Frontend uses defensive capability checks (`'method' in actor`) to support versioned/backward-compatible backend APIs.",
    "A simple in-memory Notification Center pattern (global state + subscription hook) is used for persistent warning surfacing."
  ],
  "known_issues": [
    "Backend `fetchUSDTPriceFromBinance` performs an HTTPS outcall but returns a hard-coded price (3.5) and does not parse the HTTP response body.",
    "Backend does not expose the Version-10-style APIs referenced by the frontend capability checks in this code snapshot (e.g., `getSystemStatus`, `startAgentV10`, `getLiveDataSourceStatus`, `setLiveDataSource`), so related UI may remain in fallback/\"not implemented\" states depending on deployed candid.",
    "`LiveDetectionsPanel` fetches events via `getSafeOptimizerDataset` (safe-only), so High-Risk events will never appear as \"Red-Risk\" even though the UI supports it.",
    "Shadow execution evaluation is not implemented as real market-following logic: `startShadowTradeEvaluationTimer/evaluateShadowTrades` add sample trades and update a hard-coded trade ID, producing non-realistic metrics/logs.",
    "Shadow trade entry price computation is incorrect/stubbed (`calculateEntryPrice` uses `estimatedReturn` as a price).",
    "Multiple backend logs (`priceSnapshots`, `decisionLog`, `latencyLog`, `signalDetectionEvents`, `shadowTrades`) are unbounded Lists with no retention/compaction, risking memory growth.",
    "No access control is applied to mutating backend methods (e.g., config writes, snapshot writes); any caller can modify global state.",
    "`setDEXConfigStatus` deactivates a DEX by overwriting `canisterId` with an empty string, losing the original value instead of tracking an explicit status flag.",
    "Frontend Market Watch maintains snapshots mostly in local component state; it does not query and render backend-stored snapshots/history.",
    "Some frontend widgets are explicitly simulated (e.g., Sensory Cortex mock DEX prices; ckBTC/ICP ratio calculation derived from `getPoolPrice` with constants), which can conflict with \"live\" labeling unless backed by real data sources."
  ],
  "isFixRequest": false,
  "gameProjectType": "none",
  "projectName": "icp_quant_agent",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}